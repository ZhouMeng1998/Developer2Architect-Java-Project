## Week1-万丈高楼，地基首要

#### [1-2 大型网站的特点与设计宗旨](../PDF/1-2.pdf)

#### 1.3 大型网站架构演变历程

![image-20201009204742499](https://raw.githubusercontent.com/ZhouMeng1998/IMG/image-upload/20201009204742.png)

早期是单体架构模式，网站没什么用户访问，一台服务器就够，文件服务器与数据库也部署在这个服务器内，页面是打包成war包部署在服务器上（即上线）

![image-20201009210034864](https://raw.githubusercontent.com/ZhouMeng1998/IMG/image-upload/20201009210035.png)随着项目规模变大，**开始将文件服务器与数据库从服务器分离**，这样即便服务器挂了，文件服务器和数据库可以正常访问

![image-20201009210259930](https://raw.githubusercontent.com/ZhouMeng1998/IMG/image-upload/20201009210300.png)

随着数据库规模不断增大，出现了**缓存中间件**的概念（如redis），这样用户首先是从缓存中查询，然后再从数据库查询，访问网站速度更快了。

![image-20201009210526667](https://raw.githubusercontent.com/ZhouMeng1998/IMG/image-upload/20201009210526.png)

随后又出现了**负载均衡**和**集群（cluster）**的概念，避免宕机（某台服务器挂掉）对于整个项目产生太大影响，但这时候数据库依然只有一条。

![image-20201009210727304](https://raw.githubusercontent.com/ZhouMeng1998/IMG/image-upload/20201009210727.png)

到了千万级项目，就出现了**数据库读写分离**的技术，因为用户写读遵循**20/80**原则，而读相对快，大量写入则对数据库要求比较高，所以就设置**主从两个数据库**，这样给用户的感觉是读取速度（访问网页）速度非常快。同时主从服务器之间也要不断进行**同步**。

![image-20201009211354403](https://raw.githubusercontent.com/ZhouMeng1998/IMG/image-upload/20201009211354.png)随后又出现了**数据库集群（分布式数据库）**的技术，可以把很大的一张表拆成N张更小的表**散列**到不同的子数据库中，查询的时候通过散列技术找到对应数据库，也就能找到对应的那一截表。



通常当表的规模达到700W条数据时就要采用数据库集群了，否则数据库性能会急剧下降，此时主键就不能用自增长了，而要用**分布式主键**

![image-20201009212448679](https://raw.githubusercontent.com/ZhouMeng1998/IMG/image-upload/20201009212448.png)

**搜索引擎（如ElasticSearch）**技术是为了解决**用户多样化的查询**（比如模糊查询）需求而产生的的，它**对数据库也做了保护**，用户的查询不会轻易动数据库

![image-20201009212805503](https://raw.githubusercontent.com/ZhouMeng1998/IMG/image-upload/20201009212805.png)

项目更大之后，开始出现**业务分离**，每个业务对应于一个团队，都有一个tech lead去带，也可以用到主从数据库以及服务集群的技术，当然这对于DevOps和QA都是较大的挑战

![image-20201009213058801](https://raw.githubusercontent.com/ZhouMeng1998/IMG/image-upload/20201009213115.png)

微服务架构中存在某些**公共服务资源**，比如这里的短信邮件推送微服务，这个服务可能是被订单服务以及商品服务这两个业务共用的。就如同操作系统对于进程有一套同步/异步的机制，**异步队列MQ**也是用来解决不同业务之间的异步问题的。在此过程中又涉及到**分布式**和**调优**两大技术。

